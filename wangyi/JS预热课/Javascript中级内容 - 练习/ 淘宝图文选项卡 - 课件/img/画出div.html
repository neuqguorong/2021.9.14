<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #d1{width: 400px;height: 400px;border: 1px solid black;position: relative;left: 50%;top: 50%;margin-left: -200px;margin-top: 200px;}
        div{border: 1px solid black;}
    </style>
</head>
<body>
    <div id="d1"></div>
</body>
<script>
    d1.onmousedown=function(e){
        var ev=e||event;
        var l=ev.clientX,t=ev.clientY;
        var odiv=document.createElement('div');
        odiv.style.position='absolute';
        odiv.style.left=ev.clientX-this.offsetLeft+'px';
        odiv.style.top=ev.clientY-this.offsetTop+'px';
        odiv.style.background='rgb('+parseInt(Math.random()*256)+','+parseInt(Math.random()*256)+','+parseInt(Math.random()*256)+')';
        d1.appendChild(odiv);
        console.log(ev.clientX,ev.clientY);
        document.onmousemove=function(e){
             var ev=e||event;
/*            if(ev.clientX<d1.offsetLeft){
                ev.clientX=d1.offsetLeft;console.log(ev.clientX,1);
            }
            if(ev.clientX>d1.offsetLeft+d1.offsetWidth)
            {
                ev.clientX=d1.offsetLeft+d1.offsetWidth;
            } */

            if(ev.clientX>=d1.offsetLeft && ev.clientX<=d1.offsetLeft+d1.offsetWidth && ev.clientY<=d1.offsetTop+d1.offsetHeight && ev.clientY>=d1.offsetTop){

                var l2=ev.clientX-l,t2=ev.clientY-t;
                if(l2>0 && t2>0)
                {
                    odiv.style.width=l2+'px';
                    odiv.style.height=t2+'px';
                    odiv.style.background='rgb('+parseInt(Math.random()*256)+','+parseInt(Math.random()*256)+','+parseInt(Math.random()*256)+')';
                }
                else if(l2>0 && t2<0){
                    odiv.style.width=l2+'px';
                    odiv.style.top=t-d1.offsetTop+t2+'px';
                    odiv.style.height=-t2+'px';
                    odiv.style.background='rgb('+parseInt(Math.random()*256)+','+parseInt(Math.random()*256)+','+parseInt(Math.random()*256)+')';
                }
                else if(l2<0 && t2<0){
                    odiv.style.top=t-d1.offsetTop+t2+'px';
                    odiv.style.left=l-d1.offsetLeft+l2+'px';
                    odiv.style.width=-l2+'px';
                    odiv.style.height=-t2+'px';
                    odiv.style.background='rgb('+parseInt(Math.random()*256)+','+parseInt(Math.random()*256)+','+parseInt(Math.random()*256)+')';
                
                }
                else if(l2<0 && t2>0){
                    odiv.style.left=l-d1.offsetLeft+l2+'px';
                    odiv.style.width=-l2+'px';
                    odiv.style.height=t2+'px';
                    odiv.style.background='rgb('+parseInt(Math.random()*256)+','+parseInt(Math.random()*256)+','+parseInt(Math.random()*256)+')';
                }

            }

        }
        document.onmouseup=function(){
            document.onmousemove=document.onmouseup=null;
        }
    }
</script>
</html>